x$geometry_map
## if all layers share a triangle we keep them
index <- x$index %>% group_by(triangle_idx) %>% dplyr::filter(n() > 1)
## if all layers share a triangle we keep them
index <- x$index %>% group_by(triangle_idx) %>% dplyr::filter(n() > 1) %>% ungroup()
index$layer <- x$geometry_map$layer[match(index$path_, x$geometry_map$path)]
index
tail(index)
triangles <- x$primitives$T[index$triangle_idx, ]
polypath(x$primitives$P[t(cbind(triangles, triangles[,1], NA)), ], ...)... =
sb_intersection <- function(x, ...) {
plot(x)
## if all layers share a triangle we keep them
index <- x$index %>% group_by(triangle_idx) %>% dplyr::filter(n() > 1) %>% ungroup()
index$layer <- x$geometry_map$layer[match(index$path_, x$geometry_map$path)]
triangles <- x$primitives$T[index$triangle_idx, ]
polypath(x$primitives$P[t(cbind(triangles, triangles[,1], NA)), ], ...)
}
sb_intersection(x)
sb_intersection <- function(x, ...) {
plot(x)
## if all layers share a triangle we keep them
index <- x$index %>% group_by(triangle_idx) %>% dplyr::filter(n() > 1) %>% ungroup()
index$layer <- x$geometry_map$layer[match(index$path_, x$geometry_map$path)]
triangles <- x$primitives$T[index$triangle_idx, ]
polypath(x$primitives$P[head(t(cbind(triangles, triangles[,1], NA)), -1L), ], ...)
}
sb_intersection(x)
sb_intersection(x, col = "grey")
plot(A)
plot(A[,])
plot(A[,1])
plot(A[,1], legend = F)
plot(A[,1], reset = TRUE)
plot(B, add = T)
plot.sf <- function(x, ...) sp::plot(as(x, "Spatial"), ...)
plot(A)
plot(B, add  = T)
plot(C, add  = T)
sb_intersection(x, col = "grey")
x$index
x$geometry_map
x$index$path_
sb_intersection(spacebucket(A, B), col = "grey")
sb_intersection(spacebucket(A, C), col = "grey")
sb_intersection(spacebucket(B, C), col = "grey")
sb_intersection(spacebucket(A, B, C), col = "grey")
usethis::use_readme_rmd()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
plot(st_geometry(A), col = viridis::viridis(nrow(A)))
plot(st_geometry(B), col = "firebrick", add = TRUE)
plot(st_geometry(A), col = viridis::viridis(nrow(A)))
plot(st_geometry(B), col = "firebrick", add = TRUE)
plot(st_geometry(C), col = "dodgerblue", add = TRUE)
library(spacebucket)
bucket <- spacebucket(A, B, C)
plot(st_geometry(A), col = viridis::viridis(nrow(A)))
plot(st_geometry(B), col = "firebrick", add = TRUE)
plot(st_geometry(C), col = "dodgerblue", add = TRUE)
library(spacebucket)
## summarize the contents
(bucket <- spacebucket(A, B, C))
## show the components pieces
plot(bucket)
## show the components pieces
plot(bucket, asp = 1)
devtools::load_all(".")
plot(st_geometry(A), col = viridis::viridis(nrow(A)))
plot(st_geometry(B), col = "firebrick", add = TRUE)
plot(st_geometry(C), col = "dodgerblue", add = TRUE)
library(spacebucket)
## summarize the contents
(bucket <- spacebucket(A, B, C))
## show the components pieces
plot(bucket, asp = 1)
spacebucket:::sb_intersection(bucket)
devtools::load_all(".")
spacebucket:::sb_intersection(bucket)
devtools::load_all(".")
spacebucket:::sb_intersection(bucket)
spacebucket:::sb_intersection(bucket, col = "firebrick")
spacebucket:::sb_intersection(bucket, col = "firebrick")
## but it works with pairs
spacebucket:::sb_intersection(spacebucket(A, B), col = "firebrick")
spacebucket:::sb_intersection(spacebucket(C, B), col = "firebrick")
library(spacebucket)
usethis::create_package("../basf")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
## there's an error somewhere
spacebucket:::sb_intersection(bucket, col = "firebrick")
devtools::load_all(".")
inputs <- list(A, B, C)
layers <- unlist(lapply(seq_along(inputs), function(a) rep(a, nrow(inputs[[a]]))))
inputs0 <- lapply(seq_along(inputs),
function(x) sf::st_sf(layer = rep(x, length(inputs[[x]][[1]])), geometry = sf::st_geometry(inputs[[x]])))
## TODO1
## triangulate the mesh
sfall <- do.call(rbind, inputs0)
path <- silicate::PATH(sfall)
RTri <- pfft::edge_RTriangle(path)
## TODO2
## identify all points by overlap with inputs
map <- pfft::path_triangle_map(path, RTri)
map
index <-   map %>% dplyr::mutate(path_ = match(path_, path$path$path_))
paths <- path[["path"]] %>% dplyr::transmute(subobject, object, ncoords_,
layer = layers[object],
path = dplyr::row_number())
st_make_grid()
st_make_grid(cellsize = c(2, 1))
st_make_grid()
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
plot(R)
library(basf)
plot(R)
graphics.off()
plot(R)
R
class(R)
plot.sf
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
library(basf)
plot(R)
plot(A)
devtools::load_all(".")
plot(A)
plot(R)
R
plot(st_geometry(R))
raster::extent(-1, 1, 0, 1)
raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2)
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
library(sf)
plot(R)
plot(R$geometry)
library(sf)
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
R
plot(R)
plot(st_geometry(R))
graphics.off()
plot(st_geometry(R))
st_geometry(R)
R <- spex::polygonize(setValues(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
plot(R)
library(basf)
plot(R)
sp::HexPoints2SpatialPolygons(SpatialPoints(cbind(0, 0)))
sp::HexPoints2SpatialPolygons(sp::SpatialPoints(cbind(0, 0)))
sp::SpatialPoints(cbind(0, 0))
sp::HexPoints2SpatialPolygons(sp::SpatialPoints(cbind(0:1, 0:1)))
sp::SpatialPoints(cbind(0:1, 0:1))
?sp::HexPoints2SpatialPolygons
sp::HexPoints2SpatialPolygons(sp::SpatialPoints(cbind(c(0, 0, 1, 1), c(0, 1, 0, 1))))
sp::SpatialPoints(cbind(c(0, 0, 1, 1), c(0, 1, 0, 1)))
plot(sp::SpatialPoints(cbind(c(0, 0, 1, 1), c(0, 1, 0, 1))))
library(sp)
plot(sp::SpatialPoints(cbind(c(0, 0, 1, 1), c(0, 1, 0, 1))))
sp::HexPoints2SpatialPolygons(sp::SpatialPoints(cbind(c(0, 1), c(0, 0))))
sp::SpatialPoints(cbind(c(0, 1), c(0, 0)))
plot(sp::SpatialPoints(cbind(c(0, 1), c(0, 0))))
sp::spsample(R)
sp::spsample(as(R, "Spatial"))
sp::spsample(as(R, "Spatial"), type = "hexagonal")
sp::spsample(as(R, "Spatial"), type = "hexagonal", to = 1)
sp::spsample(as(R, "Spatial"), type = "hexagonal", 1)
sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 1))
sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 2))
sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 4))
plot(R)
plot(sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 4), add = TRUE)
)
plot(sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 4)), add = TRUE)
plot(sp::HexPoints2SpatialPolygons(sp::spsample(as(R, "Spatial"), type = "hexagonal", 4)), add = F)
plot(R)
R
cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
points(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
plot(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
plot(R, xlim = c(-2, 2), ylim = c(-2, 2))
points(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
points(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
plot(R, xlim = c(-1, 1), ylim = c(-1, 1), asp = 1)
points(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
plot(R, xlim = c(-1, 1), ylim = c(-1, 1.5), asp = 1)
points(cbind(c(0, -0.25, -0.25, 0, 0.25, 0.25, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
points(cbind(c(0, -0.5, -0.5, 0, 0.5, 0.5, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
R <- spex::polygonize(raster::raster(raster::extent(-1, 1, 0, 1), nrows = 1, ncols = 2))
plot(R, xlim = c(-1, 1), ylim = c(-1, 1.5), asp = 1)
points(cbind(c(0, -0.5, -0.5, 0, 0.5, 0.5, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)
)
#plot(R, xlim = c(-1, 1), ylim = c(-1, 1.5), asp = 1)
H <- st_sfc(st_polygon(list(
cbind(c(0, -0.5, -0.5, 0, 0.5, 0.5, 0),
c(-0.25, 0.25, 0.75, 1.25, 0.75, 0.25, -0.25))
)))
plot(H)
plot(H, asp = 1)
read.csv("0,-1
-1,-1
-1,0
0,1
0,1
1,0")
read.csv(text = "0,-1
-1,-1
-1,0
0,1
0,1
1,0")
read.csv(text = "0,-1
-1,-1
-1,0
0,1
0,1
1,0") %>% plot()
read.csv(text = "0,-1
-1,-1
-1,0
0,1
0,1
1,0") %>% plot(asp = 1)
plot(R)
grid()
axis(1)
axis(2)
cadfile <- raadfiles::thelist_files(pattern = "parcels_hobart")
cadfile
?raadfiles::thelist_files
?raadfiles::thelist
thelist_files()
f <- raadfiles::thelist_files()
f
f$file
f1 <- raadfiles::thelist_files(pattern = "RASPBERRIES")
f2 <- raadfiles::thelist_files(pattern = "STRAWBERRIES")
plot(read_sf(f1))
plot(read_sf(f1$fullname[1]))
library(basf)
plot(read_sf(f1$fullname[1]))
x <- read_sf(f1$fullname[1])
f1$fullname[1]
f1 <- raadfiles::thelist_files(pattern = "RASPBERRIES", format = "shp")
f1
st_layers(f1$fullname[1])
f1 <- raadfiles::thelist_files(pattern = "hobart_parcels")
f2 <- raadfiles::thelist_files(pattern = "water_districts")
f2
x1 <- read_sf(f1$fullname[1])
x2 <- read_sf(f2$fullname[1])
f1
f1 <- raadfiles::thelist_files(pattern = "parcels_hobart")
x1 <- read_sf(f1$fullname[1])
plot(x1)
plot(x2)
plot(x1, add = T)
plot(x1, add = T, col = "red")
f2 <- raadfiles::thelist_files(pattern = "tasveg_30_groups_hobart")
x1 <- read_sf(f1$fullname[1])
x2 <- read_sf(f2$fullname[1])
plot(x2)
plot(x2, col = viridis::viridis(nrow(x2)))
plot(x1, add = T)
library(spacebucket)
bucket <- spacebucket(x1, x2)
dim(x1)
plot(x1[1:10, ])
plot(x2[x1, ])
plot(x1[1:10, ])
plot(x2, add = TRUE)
plot(x2[x1[1:10, ], ])
x1 <- x1[1:10, ]
x2 <- x2[x1, ]
library(spacebucket)
bucket <- spacebucket(x1, x2)
plot(bucket)
devtools::load_all(".")
sb_intersection(bucket)
sb_intersection(bucket, col = "firebrick")
inputs <- list(A, B, C)
inputs <- list(...)
layers <- unlist(lapply(seq_along(inputs), function(a) rep(a, nrow(inputs[[a]]))))
inputs0 <- lapply(seq_along(inputs),
function(x) sf::st_sf(layer = rep(x, length(inputs[[x]][[1]])), geometry = sf::st_geometry(inputs[[x]])))
devtools::load_all(".")
inputs <- spacebucket(A, B, C)
layers <- unlist(lapply(seq_along(inputs), function(a) rep(a, nrow(inputs[[a]]))))
inputs <- list(A, B, C)
layers <- unlist(lapply(seq_along(inputs), function(a) rep(a, nrow(inputs[[a]]))))
inputs0 <- lapply(seq_along(inputs),
function(x) sf::st_sf(layer = rep(x, length(inputs[[x]][[1]])), geometry = sf::st_geometry(inputs[[x]])))
## TODO1
## triangulate the mesh
sfall <- do.call(rbind, inputs0)
path <- silicate::PATH(sfall)
RTri <- pfft::edge_RTriangle(path)
## TODO2
## identify all points by overlap with inputs
map <- pfft::path_triangle_map(path, RTri)
map
index <-   map %>% dplyr::mutate(path_ = match(path_, path$path$path_))
paths <- path[["path"]] %>% dplyr::transmute(subobject, object, ncoords_,
layer = layers[object],
path = dplyr::row_number())
pfft::path_triangle_map
plot(map$triangle_idx)
library(spacebucket)
sessionInfo()
usethis::use_package("lattice")
library(spacebucket)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
st_jitter(A, 0.1)
plot(st_jitter(A, 0.1))
?st_jitter
spacebucket:::sb_intersection(spacebucket(C, B, A, st_jitter(A, 0.1)), col = "firebrick")
spacebucket:::sb_intersection(bucket, col = "firebrick")
sst <- tabularaster::ghrsst
p <- contourPolys::fcontour(xFromCol(sst), rev(yFromRow(sst)),
as.matrix(sst))
library(raster)
p <- contourPolys::fcontour(xFromCol(sst), rev(yFromRow(sst)),
as.matrix(sst))
p <- contourPolys::fcontour(xFromCol(sst), rev(yFromRow(sst, 1:nrow(sst))),
as.matrix(sst))
plot(sst)
p <- contourPolys::fcontour(xFromCol(sst), rev(yFromRow(sst, 1:nrow(sst))),
as.matrix(sst), c(5, 10, 15, 20))
str(p)
p <- rasterToPolygons(sst %/% 5)
sst_ranges <- spex::polygonize(sst %/% 5)
sst_ranges
names(sst_ranges)
sst_ranges <- spex::polygonize(sst %/% 5) %>%
group_by(names(sst)) %>% summarize()
library(sf)
sst_ranges <- spex::polygonize(sst %/% 5) %>%
group_by(names(sst)) %>% summarize()
library(dplyr)
sst_ranges <- spex::polygonize(sst %/% 5) %>%
group_by(names(sst)) %>% summarize()
plot(sst_ranges)
library(raster)
library(sf)
library(dplyr)
sst <- disaggregate(tabularaster::ghrsst, fact = 5)
sst_ranges <- spex::polygonize(sst %/% 5) %>%
group_by(analysed.sea.surface.temperature) %>% summarize()
library(raster)
library(sf)
library(dplyr)
sst <- aggregate(tabularaster::ghrsst, fact = 5)
sst_ranges <- spex::polygonize(sst %/% 5) %>%
group_by(analysed.sea.surface.temperature) %>% summarize()
plot(sst_ranges)
topo <- crop(anglr::gebco1, extent(sst))
plot(topo)
topo
names(topo)
topo_ranges <-spex::polygonize(topo %/% 50) %>%
group_by(gebco01) %>% summarize()
topo_ranges <-spex::polygonize(topo %/% 50) %>%
group_by(gebco1) %>% summarize()
plot(topo_ranges)
topo_ranges <-spex::polygonize(topo %/% 500) %>%
group_by(gebco1) %>% summarize()
plot(topo_ranges)
sb <- spacebucket(sst_ranges, topo_ranges)
devtools::load_all(".")
sb <- spacebucket(sst_ranges, topo_ranges)
plot(sb)
sb_intersection(sb)
sb_intersection(sb, col = "firebrick")
plot(sst_ranges)
library(basf)
plot(sst_ranges)
plot(topo_ranges, add = TRUE)
plot(topo_ranges, add = TRUE, col = NA)
plot(sst_ranges)
plot(topo_ranges, add = TRUE, col = NA)
library(help = spdep)
?over
vignette("over")
pol = SpatialPolygons(list(
Polygons(list(Polygon(cbind(xpol-1.05,ypol))), ID="x1"),
Polygons(list(Polygon(cbind(xpol,ypol))), ID="x2"),
Polygons(list(Polygon(cbind(xpol,ypol - 1.0))), ID="x3"),
Polygons(list(Polygon(cbind(xpol + 1.0, ypol))), ID="x4"),
Polygons(list(Polygon(cbind(xpol+.4, ypol+.1))), ID="x5")
))
library(sp)
x = c(0.5, 0.5, 1.0, 1.5)
y = c(1.5, 0.5, 0.5, 0.5)
xy = cbind(x,y)
dimnames(xy)[[1]] = c("a", "b", "c", "d")
pts = SpatialPoints(xy)
xpol = c(0,1,1,0,0)
ypol = c(0,0,1,1,0)
pol = SpatialPolygons(list(
Polygons(list(Polygon(cbind(xpol-1.05,ypol))), ID="x1"),
Polygons(list(Polygon(cbind(xpol,ypol))), ID="x2"),
Polygons(list(Polygon(cbind(xpol,ypol - 1.0))), ID="x3"),
Polygons(list(Polygon(cbind(xpol + 1.0, ypol))), ID="x4"),
Polygons(list(Polygon(cbind(xpol+.4, ypol+.1))), ID="x5")
))
plot(pol)
disaggregate(pol)
spacebucket(pol[1])
class(pol)
pol <- spPolygons(disaggregate(pol), attr = 1:5)
pol <- spPolygons(disaggregate(pol), attr = data.frame(a= 1:5))
disaggregate(pol)
pol <- spPolygons(disaggregate(pol), attr = data.frame(a = 1:5))
pol <- SpatialPolygonsDataFrame(disaggregate(pol), attr = data.frame(a = 1:5))
pol <- SpatialPolygonsDataFrame(disaggregate(pol), data.frame(a = 1:5))
spacebucket(pol[1])
pol <- st_as_sf(SpatialPolygonsDataFrame(disaggregate(pol), data.frame(a = 1:5)))
spacebucket(pol[1])
spacebucket(pol[1, ], pol[2, ], pol[3, ], pol[4, ], pol[5, ])
(polb <- spacebucket(pol[1, ], pol[2, ], pol[3, ], pol[4, ], pol[5, ]))
plot(polb)
sb_intersection(polb)
plot(polb)
sb_intersection(polb)
devtools::load_all(".")
sb_intersection(polb)
usethis::create_project("../datatas")
library(spacebucket)
library(spacebucket)
plot(A)
plot(B)
plot(C)
library(sf)
# example data from raster package
soil <- st_read(system.file("external/lux.shp", package="raster")) %>%
# add in some fake soil type data
mutate(soil = LETTERS[c(1:6,1:6)]) %>%
select(soil)
# field polygons
field <- c("POLYGON((6 49.75,6 50,6.4 50,6.4 49.75,6 49.75))",
"POLYGON((5.8 49.5,5.8 49.7,6.2 49.7,6.2 49.5,5.8 49.5))") %>%
st_as_sfc(crs = st_crs(soil)) %>%
st_sf(field = c('x','y'), geoms = ., stringsAsFactors = FALSE)
usethis::use_data(soil, field)
library(sf)
library(dplyr)
# example data from raster package
soil <- st_read(system.file("external/lux.shp", package="raster")) %>%
# add in some fake soil type data
mutate(soil = LETTERS[c(1:6,1:6)]) %>%
select(soil)
# field polygons
field <- c("POLYGON((6 49.75,6 50,6.4 50,6.4 49.75,6 49.75))",
"POLYGON((5.8 49.5,5.8 49.7,6.2 49.7,6.2 49.5,5.8 49.5))") %>%
st_as_sfc(crs = st_crs(soil)) %>%
st_sf(field = c('x','y'), geoms = ., stringsAsFactors = FALSE)
usethis::use_data(soil, field)
sb <- spacebucket(soil, field)
devtools::load_all(".")
devtools::install_github("hypertidy/silicate")
devtools::load_all(".")
library(spacebucket)
devtools::load_all(".")
sb <- spacebucket(soil, field)
sb
plot(sb)
plot(sb, col = "firebrick")
sb_ine
sb_intersection(sb)
field
soil
pi <- st_intersection(soil, field)
plot(pi)
?st_intersection
pi
sb
names(sb)
sb$geometry_map
sb$index
